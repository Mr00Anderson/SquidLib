<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>Source code</title>
<meta name="description" content="source: package: squidpony.squidgrid.mapping, class: WildMap">
<meta name="generator" content="javadoc/SourceToHTMLConverter">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body class="source">
<main role="main">
<div class="sourceContainer">
<pre><span class="sourceLineNo">001</span><a id="line.1">package squidpony.squidgrid.mapping;</a>
<span class="sourceLineNo">002</span><a id="line.2"></a>
<span class="sourceLineNo">003</span><a id="line.3">import squidpony.ArrayTools;</a>
<span class="sourceLineNo">004</span><a id="line.4">import squidpony.FakeLanguageGen;</a>
<span class="sourceLineNo">005</span><a id="line.5">import squidpony.Maker;</a>
<span class="sourceLineNo">006</span><a id="line.6">import squidpony.Thesaurus;</a>
<span class="sourceLineNo">007</span><a id="line.7">import squidpony.annotation.Beta;</a>
<span class="sourceLineNo">008</span><a id="line.8">import squidpony.squidgrid.Direction;</a>
<span class="sourceLineNo">009</span><a id="line.9">import squidpony.squidmath.BlueNoise;</a>
<span class="sourceLineNo">010</span><a id="line.10">import squidpony.squidmath.IRNG;</a>
<span class="sourceLineNo">011</span><a id="line.11">import squidpony.squidmath.IStatefulRNG;</a>
<span class="sourceLineNo">012</span><a id="line.12">import squidpony.squidmath.SilkRNG;</a>
<span class="sourceLineNo">013</span><a id="line.13"></a>
<span class="sourceLineNo">014</span><a id="line.14">import java.io.Serializable;</a>
<span class="sourceLineNo">015</span><a id="line.15">import java.util.ArrayList;</a>
<span class="sourceLineNo">016</span><a id="line.16"></a>
<span class="sourceLineNo">017</span><a id="line.17">/**</a>
<span class="sourceLineNo">018</span><a id="line.18"> * A finite 2D area map for some kind of wilderness, with specifics handled by subclasses.</a>
<span class="sourceLineNo">019</span><a id="line.19"> * Regional maps for wilderness areas have very different requirements from mostly-artificial dungeons. This is intended</a>
<span class="sourceLineNo">020</span><a id="line.20"> * to work alongside {@link WorldMapGenerator} and {@link WorldMapGenerator.DetailedBiomeMapper} to produce blends</a>
<span class="sourceLineNo">021</span><a id="line.21"> * between biomes where a strict line can't be drawn between, say, woodland and grassland.</a>
<span class="sourceLineNo">022</span><a id="line.22"> * &lt;br&gt;</a>
<span class="sourceLineNo">023</span><a id="line.23"> * Using this code mostly involves constructing a subclass, adding kinds of game objects that you want to appear</a>
<span class="sourceLineNo">024</span><a id="line.24"> * in this type of map to {@link #contentTypes}, and only then calling {@link #generate()}, which is implemented by</a>
<span class="sourceLineNo">025</span><a id="line.25"> * subclasses only. You can use just about any type for {@code T}, including {@link Object}; all this code uses is the</a>
<span class="sourceLineNo">026</span><a id="line.26"> * number of items in {@link #contentTypes} to put correct indices into {@link #content}. Because contentTypes is an</a>
<span class="sourceLineNo">027</span><a id="line.27"> * ArrayList, you can have and are encouraged to have duplicates when an object should appear more often. An index of -1</a>
<span class="sourceLineNo">028</span><a id="line.28"> * in content indicates nothing of note is present there. There is also a String array of {@link #floorTypes} that is</a>
<span class="sourceLineNo">029</span><a id="line.29"> * not typically user-set unless you subclass WildMap yourself; it is used to look up the indices in {@link #floors}.</a>
<span class="sourceLineNo">030</span><a id="line.30"> * The floors are set to reasonable values for the particular subclass, so a forest might have "dirt" and "leaves" among</a>
<span class="sourceLineNo">031</span><a id="line.31"> * others, while a desert might only have "sand". Again, only the indices matter, so you could change the values in</a>
<span class="sourceLineNo">032</span><a id="line.32"> * {@link #floorTypes} to match names of textures in a graphical game and make lookup easier, or to a char followed by</a>
<span class="sourceLineNo">033</span><a id="line.33"> * the name of a color (as in SColor in the display module) for a text-based game.</a>
<span class="sourceLineNo">034</span><a id="line.34"> * &lt;br&gt;</a>
<span class="sourceLineNo">035</span><a id="line.35"> * Created by Tommy Ettinger on 10/16/2019.</a>
<span class="sourceLineNo">036</span><a id="line.36"> */</a>
<span class="sourceLineNo">037</span><a id="line.37">@Beta</a>
<span class="sourceLineNo">038</span><a id="line.38">public class WildMap implements Serializable {</a>
<span class="sourceLineNo">039</span><a id="line.39">    private static final long serialVersionUID = 1L;</a>
<span class="sourceLineNo">040</span><a id="line.40">    public final int width, height;</a>
<span class="sourceLineNo">041</span><a id="line.41">    public int biome;</a>
<span class="sourceLineNo">042</span><a id="line.42">    public IStatefulRNG rng;</a>
<span class="sourceLineNo">043</span><a id="line.43">    public ArrayList&lt;String&gt; contentTypes;</a>
<span class="sourceLineNo">044</span><a id="line.44">    public ArrayList&lt;String&gt; floorTypes;</a>
<span class="sourceLineNo">045</span><a id="line.45">    public final int[][] content, floors;</a>
<span class="sourceLineNo">046</span><a id="line.46"></a>
<span class="sourceLineNo">047</span><a id="line.47">    /**</a>
<span class="sourceLineNo">048</span><a id="line.48">     * Meant for generating large ArrayLists of Strings where an individual String may occur quite a few times.</a>
<span class="sourceLineNo">049</span><a id="line.49">     * The rest parameter is a vararg (it may also be an Object array) of alternating String and Integer values, where</a>
<span class="sourceLineNo">050</span><a id="line.50">     * an Integer is how many times to repeat the preceding String in the returned ArrayList.</a>
<span class="sourceLineNo">051</span><a id="line.51">     * @param rest a vararg (or Object array) of alternating String and Integer values</a>
<span class="sourceLineNo">052</span><a id="line.52">     * @return an ArrayList of Strings, probably with some or most of them repeated; you may want to shuffle this result</a>
<span class="sourceLineNo">053</span><a id="line.53">     */</a>
<span class="sourceLineNo">054</span><a id="line.54">    public static ArrayList&lt;String&gt; makeRepeats(Object... rest)</a>
<span class="sourceLineNo">055</span><a id="line.55">    {</a>
<span class="sourceLineNo">056</span><a id="line.56">        if(rest == null || rest.length &lt; 2)</a>
<span class="sourceLineNo">057</span><a id="line.57">        {</a>
<span class="sourceLineNo">058</span><a id="line.58">            return new ArrayList&lt;&gt;(0);</a>
<span class="sourceLineNo">059</span><a id="line.59">        }</a>
<span class="sourceLineNo">060</span><a id="line.60">        ArrayList&lt;String&gt; al = new ArrayList&lt;&gt;(rest.length);</a>
<span class="sourceLineNo">061</span><a id="line.61"></a>
<span class="sourceLineNo">062</span><a id="line.62">        for (int i = 0; i &lt; rest.length - 1; i+=2) {</a>
<span class="sourceLineNo">063</span><a id="line.63">            try {</a>
<span class="sourceLineNo">064</span><a id="line.64">                int count = (int)rest[i+1];</a>
<span class="sourceLineNo">065</span><a id="line.65">                String v = (String) rest[i];</a>
<span class="sourceLineNo">066</span><a id="line.66">                for (int j = 0; j &lt; count; j++) {</a>
<span class="sourceLineNo">067</span><a id="line.67">                    al.add(v);</a>
<span class="sourceLineNo">068</span><a id="line.68">                }</a>
<span class="sourceLineNo">069</span><a id="line.69">            }catch (ClassCastException ignored) {</a>
<span class="sourceLineNo">070</span><a id="line.70">            }</a>
<span class="sourceLineNo">071</span><a id="line.71">        }</a>
<span class="sourceLineNo">072</span><a id="line.72">        return al;</a>
<span class="sourceLineNo">073</span><a id="line.73">    }</a>
<span class="sourceLineNo">074</span><a id="line.74">    public static ArrayList&lt;String&gt; makeShuffledRepeats(IRNG rng, Object... rest) </a>
<span class="sourceLineNo">075</span><a id="line.75">    {</a>
<span class="sourceLineNo">076</span><a id="line.76">        ArrayList&lt;String&gt; al = makeRepeats(rest);</a>
<span class="sourceLineNo">077</span><a id="line.77">        rng.shuffleInPlace(al);</a>
<span class="sourceLineNo">078</span><a id="line.78">        return al;</a>
<span class="sourceLineNo">079</span><a id="line.79">    }</a>
<span class="sourceLineNo">080</span><a id="line.80">    public static ArrayList&lt;String&gt; makeVegetation(IRNG rng, int size, double monoculture, FakeLanguageGen naming)</a>
<span class="sourceLineNo">081</span><a id="line.81">    {</a>
<span class="sourceLineNo">082</span><a id="line.82">        Thesaurus t = new Thesaurus(rng);</a>
<span class="sourceLineNo">083</span><a id="line.83">        ArrayList&lt;String&gt; al = new ArrayList&lt;&gt;(size);</a>
<span class="sourceLineNo">084</span><a id="line.84">        String latest;</a>
<span class="sourceLineNo">085</span><a id="line.85">        for (int i = size; i &gt; 0; i--) {</a>
<span class="sourceLineNo">086</span><a id="line.86">            al.add(latest = t.makePlantName(naming));</a>
<span class="sourceLineNo">087</span><a id="line.87">            for (double j = rng.nextDouble(monoculture * 2.0 * size); j &gt;= 1 &amp;&amp; i &gt; 0; j--, i--) {</a>
<span class="sourceLineNo">088</span><a id="line.88">                al.add(latest);</a>
<span class="sourceLineNo">089</span><a id="line.89">            }</a>
<span class="sourceLineNo">090</span><a id="line.90">        }</a>
<span class="sourceLineNo">091</span><a id="line.91">        rng.shuffleInPlace(al);</a>
<span class="sourceLineNo">092</span><a id="line.92">        return al;</a>
<span class="sourceLineNo">093</span><a id="line.93">    }</a>
<span class="sourceLineNo">094</span><a id="line.94"></a>
<span class="sourceLineNo">095</span><a id="line.95">    public static ArrayList&lt;String&gt; floorsByBiome(int biome, IRNG rng) {</a>
<span class="sourceLineNo">096</span><a id="line.96">        biome &amp;= 1023;</a>
<span class="sourceLineNo">097</span><a id="line.97">        switch (biome) {</a>
<span class="sourceLineNo">098</span><a id="line.98">            case 0: //Ice</a>
<span class="sourceLineNo">099</span><a id="line.99">            case 1:</a>
<span class="sourceLineNo">100</span><a id="line.100">            case 6:</a>
<span class="sourceLineNo">101</span><a id="line.101">            case 12:</a>
<span class="sourceLineNo">102</span><a id="line.102">            case 18:</a>
<span class="sourceLineNo">103</span><a id="line.103">            case 24:</a>
<span class="sourceLineNo">104</span><a id="line.104">            case 30:</a>
<span class="sourceLineNo">105</span><a id="line.105">            case 42:</a>
<span class="sourceLineNo">106</span><a id="line.106">            case 48:</a>
<span class="sourceLineNo">107</span><a id="line.107">                return makeShuffledRepeats(rng, "snow", 3, "ice", 1);</a>
<span class="sourceLineNo">108</span><a id="line.108">            case 7: //Tundra</a>
<span class="sourceLineNo">109</span><a id="line.109">            case 13:</a>
<span class="sourceLineNo">110</span><a id="line.110">            case 19:</a>
<span class="sourceLineNo">111</span><a id="line.111">            case 25:</a>
<span class="sourceLineNo">112</span><a id="line.112">                return makeShuffledRepeats(rng, "dirt", 6, "pebbles", 1, "snow", 9, "dry grass", 4);</a>
<span class="sourceLineNo">113</span><a id="line.113">            case 26: //BorealForest</a>
<span class="sourceLineNo">114</span><a id="line.114">            case 31:</a>
<span class="sourceLineNo">115</span><a id="line.115">            case 32:</a>
<span class="sourceLineNo">116</span><a id="line.116">                return makeShuffledRepeats(rng, "dirt", 3, "pebbles", 1, "snow", 11);</a>
<span class="sourceLineNo">117</span><a id="line.117">            case 43: //River</a>
<span class="sourceLineNo">118</span><a id="line.118">            case 44:</a>
<span class="sourceLineNo">119</span><a id="line.119">            case 45:</a>
<span class="sourceLineNo">120</span><a id="line.120">            case 46:</a>
<span class="sourceLineNo">121</span><a id="line.121">            case 47:</a>
<span class="sourceLineNo">122</span><a id="line.122">            case 49:</a>
<span class="sourceLineNo">123</span><a id="line.123">            case 50:</a>
<span class="sourceLineNo">124</span><a id="line.124">            case 51:</a>
<span class="sourceLineNo">125</span><a id="line.125">            case 52:</a>
<span class="sourceLineNo">126</span><a id="line.126">            case 53:</a>
<span class="sourceLineNo">127</span><a id="line.127">                return Maker.makeList("fresh water");</a>
<span class="sourceLineNo">128</span><a id="line.128">            case 54: //Ocean</a>
<span class="sourceLineNo">129</span><a id="line.129">            case 55:</a>
<span class="sourceLineNo">130</span><a id="line.130">            case 56:</a>
<span class="sourceLineNo">131</span><a id="line.131">            case 57:</a>
<span class="sourceLineNo">132</span><a id="line.132">            case 58:</a>
<span class="sourceLineNo">133</span><a id="line.133">            case 59:</a>
<span class="sourceLineNo">134</span><a id="line.134">                return Maker.makeList("salt water");</a>
<span class="sourceLineNo">135</span><a id="line.135">            case 3: //Desert</a>
<span class="sourceLineNo">136</span><a id="line.136">            case 4:</a>
<span class="sourceLineNo">137</span><a id="line.137">            case 5:</a>
<span class="sourceLineNo">138</span><a id="line.138">            case 10:</a>
<span class="sourceLineNo">139</span><a id="line.139">            case 11:</a>
<span class="sourceLineNo">140</span><a id="line.140">            case 17:</a>
<span class="sourceLineNo">141</span><a id="line.141">            case 38: //Beach</a>
<span class="sourceLineNo">142</span><a id="line.142">            case 39:</a>
<span class="sourceLineNo">143</span><a id="line.143">            case 40:</a>
<span class="sourceLineNo">144</span><a id="line.144">            case 41:</a>
<span class="sourceLineNo">145</span><a id="line.145">                return Maker.makeList("sand");</a>
<span class="sourceLineNo">146</span><a id="line.146">            case 2: //Grassland</a>
<span class="sourceLineNo">147</span><a id="line.147">            case 8:</a>
<span class="sourceLineNo">148</span><a id="line.148">            case 9:</a>
<span class="sourceLineNo">149</span><a id="line.149">                return makeShuffledRepeats(rng, "dirt", 8, "dry grass", 13, "grass", 2);</a>
<span class="sourceLineNo">150</span><a id="line.150">            case 14: //Woodland</a>
<span class="sourceLineNo">151</span><a id="line.151">            case 15:</a>
<span class="sourceLineNo">152</span><a id="line.152">                return makeShuffledRepeats(rng, "dirt", 11, "leaves", 3, "dry grass", 8);</a>
<span class="sourceLineNo">153</span><a id="line.153">            case 16: //Savanna</a>
<span class="sourceLineNo">154</span><a id="line.154">            case 22:</a>
<span class="sourceLineNo">155</span><a id="line.155">            case 23:</a>
<span class="sourceLineNo">156</span><a id="line.156">            case 29:</a>
<span class="sourceLineNo">157</span><a id="line.157">                return makeShuffledRepeats(rng, "dirt", 4, "dry grass", 17);</a>
<span class="sourceLineNo">158</span><a id="line.158">            case 20: //SeasonalForest</a>
<span class="sourceLineNo">159</span><a id="line.159">            case 21:</a>
<span class="sourceLineNo">160</span><a id="line.160">                return makeShuffledRepeats(rng, "dirt", 9, "leaves", 6, "grass", 14);</a>
<span class="sourceLineNo">161</span><a id="line.161">            case 27: //TemperateRainforest</a>
<span class="sourceLineNo">162</span><a id="line.162">            case 33:</a>
<span class="sourceLineNo">163</span><a id="line.163">                return makeShuffledRepeats(rng, "mud", 3, "leaves", 8, "grass", 10, "moss", 5);</a>
<span class="sourceLineNo">164</span><a id="line.164">            case 28: //TropicalRainforest</a>
<span class="sourceLineNo">165</span><a id="line.165">            case 34:</a>
<span class="sourceLineNo">166</span><a id="line.166">            case 35:</a>
<span class="sourceLineNo">167</span><a id="line.167">                return makeShuffledRepeats(rng, "mud", 7, "leaves", 6, "grass", 4, "moss", 11);</a>
<span class="sourceLineNo">168</span><a id="line.168">            case 36: // Rocky</a>
<span class="sourceLineNo">169</span><a id="line.169">            case 37:</a>
<span class="sourceLineNo">170</span><a id="line.170">                return makeShuffledRepeats(rng, "pebbles", 5, "rubble", 1);</a>
<span class="sourceLineNo">171</span><a id="line.171">            default:</a>
<span class="sourceLineNo">172</span><a id="line.172">                return Maker.makeList("empty space");</a>
<span class="sourceLineNo">173</span><a id="line.173"></a>
<span class="sourceLineNo">174</span><a id="line.174">        }</a>
<span class="sourceLineNo">175</span><a id="line.175">    }</a>
<span class="sourceLineNo">176</span><a id="line.176">        public static ArrayList&lt;String&gt; contentByBiome(int biome, IRNG rng)</a>
<span class="sourceLineNo">177</span><a id="line.177">        {</a>
<span class="sourceLineNo">178</span><a id="line.178">            biome &amp;= 1023;</a>
<span class="sourceLineNo">179</span><a id="line.179">            switch (biome) {</a>
<span class="sourceLineNo">180</span><a id="line.180">                case 0: //Ice</a>
<span class="sourceLineNo">181</span><a id="line.181">                case 1:</a>
<span class="sourceLineNo">182</span><a id="line.182">                case 6:</a>
<span class="sourceLineNo">183</span><a id="line.183">                case 12:</a>
<span class="sourceLineNo">184</span><a id="line.184">                case 18:</a>
<span class="sourceLineNo">185</span><a id="line.185">                case 24:</a>
<span class="sourceLineNo">186</span><a id="line.186">                case 30:</a>
<span class="sourceLineNo">187</span><a id="line.187">                case 42:</a>
<span class="sourceLineNo">188</span><a id="line.188">                case 48:</a>
<span class="sourceLineNo">189</span><a id="line.189">                    return makeShuffledRepeats(rng, "snow mound", 5, "icy divot", 2, "powder snowdrift", 5);</a>
<span class="sourceLineNo">190</span><a id="line.190">                case 7: //Tundra</a>
<span class="sourceLineNo">191</span><a id="line.191">                case 13:</a>
<span class="sourceLineNo">192</span><a id="line.192">                case 19:</a>
<span class="sourceLineNo">193</span><a id="line.193">                case 25:</a>
<span class="sourceLineNo">194</span><a id="line.194">                    return makeShuffledRepeats(rng, "snow mound", 4, "hillock", 6, "animal burrow", 5, "small bush 1", 2);</a>
<span class="sourceLineNo">195</span><a id="line.195">                case 26: //BorealForest</a>
<span class="sourceLineNo">196</span><a id="line.196">                case 31:</a>
<span class="sourceLineNo">197</span><a id="line.197">                case 32:</a>
<span class="sourceLineNo">198</span><a id="line.198">                    return makeShuffledRepeats(rng, "snow mound", 3, "small bush 1", 5, "large bush 1", 3, "evergreen tree 1", 17, "evergreen tree 2", 12);</a>
<span class="sourceLineNo">199</span><a id="line.199">//                case 43: //River</a>
<span class="sourceLineNo">200</span><a id="line.200">//                case 44:</a>
<span class="sourceLineNo">201</span><a id="line.201">//                case 45:</a>
<span class="sourceLineNo">202</span><a id="line.202">//                case 46:</a>
<span class="sourceLineNo">203</span><a id="line.203">//                case 47:</a>
<span class="sourceLineNo">204</span><a id="line.204">//                case 49:</a>
<span class="sourceLineNo">205</span><a id="line.205">//                case 50:</a>
<span class="sourceLineNo">206</span><a id="line.206">//                case 51:</a>
<span class="sourceLineNo">207</span><a id="line.207">//                case 52:</a>
<span class="sourceLineNo">208</span><a id="line.208">//                case 53:</a>
<span class="sourceLineNo">209</span><a id="line.209">//                case 54: //Ocean</a>
<span class="sourceLineNo">210</span><a id="line.210">//                case 55:</a>
<span class="sourceLineNo">211</span><a id="line.211">//                case 56:</a>
<span class="sourceLineNo">212</span><a id="line.212">//                case 57:</a>
<span class="sourceLineNo">213</span><a id="line.213">//                case 58:</a>
<span class="sourceLineNo">214</span><a id="line.214">//                case 59:</a>
<span class="sourceLineNo">215</span><a id="line.215">//                    return new ArrayList&lt;&gt;(0);</a>
<span class="sourceLineNo">216</span><a id="line.216">                case 3: //Desert</a>
<span class="sourceLineNo">217</span><a id="line.217">                case 4:</a>
<span class="sourceLineNo">218</span><a id="line.218">                case 5:</a>
<span class="sourceLineNo">219</span><a id="line.219">                case 10:</a>
<span class="sourceLineNo">220</span><a id="line.220">                case 11:</a>
<span class="sourceLineNo">221</span><a id="line.221">                case 17:</a>
<span class="sourceLineNo">222</span><a id="line.222">                    return makeShuffledRepeats(rng, "small cactus 1", 2, "large cactus 1", 2, "succulent 1", 1, "animal burrow", 2);</a>
<span class="sourceLineNo">223</span><a id="line.223">                case 38: //Beach</a>
<span class="sourceLineNo">224</span><a id="line.224">                case 39:</a>
<span class="sourceLineNo">225</span><a id="line.225">                case 40:</a>
<span class="sourceLineNo">226</span><a id="line.226">                case 41:</a>
<span class="sourceLineNo">227</span><a id="line.227">                    return makeShuffledRepeats(rng, "seashell 1", 3, "seashell 2", 3, "seashell 3", 3, "seashell 4", 3, "driftwood", 5, "boulder", 3);</a>
<span class="sourceLineNo">228</span><a id="line.228">                case 2: //Grassland</a>
<span class="sourceLineNo">229</span><a id="line.229">                case 8:</a>
<span class="sourceLineNo">230</span><a id="line.230">                case 9:</a>
<span class="sourceLineNo">231</span><a id="line.231">                    return makeShuffledRepeats(rng, "deciduous tree 1", 3, "small bush 1", 5, "small bush 2", 4, "large bush 1", 5, "animal burrow", 8, "hillock", 4);</a>
<span class="sourceLineNo">232</span><a id="line.232">                case 14: //Woodland</a>
<span class="sourceLineNo">233</span><a id="line.233">                case 15:</a>
<span class="sourceLineNo">234</span><a id="line.234">                    return makeShuffledRepeats(rng, "deciduous tree 1", 12, "deciduous tree 2", 9, "deciduous tree 3", 6, "small bush 1", 4, "small bush 2", 3, "animal burrow", 3);</a>
<span class="sourceLineNo">235</span><a id="line.235">                case 16: //Savanna</a>
<span class="sourceLineNo">236</span><a id="line.236">                case 22:</a>
<span class="sourceLineNo">237</span><a id="line.237">                case 23:</a>
<span class="sourceLineNo">238</span><a id="line.238">                case 29:</a>
<span class="sourceLineNo">239</span><a id="line.239">                    return makeShuffledRepeats(rng, "small bush 1", 8, "small bush 2", 5, "large bush 1", 2, "animal burrow", 3, "hillock", 6);</a>
<span class="sourceLineNo">240</span><a id="line.240">                case 20: //SeasonalForest</a>
<span class="sourceLineNo">241</span><a id="line.241">                case 21:</a>
<span class="sourceLineNo">242</span><a id="line.242">                    return makeShuffledRepeats(rng, "deciduous tree 1", 15, "deciduous tree 2", 13, "deciduous tree 3", 12, "small bush 1", 3, "large bush 1", 5, "large bush 2", 4, "animal burrow", 3);</a>
<span class="sourceLineNo">243</span><a id="line.243">                case 27: //TemperateRainforest</a>
<span class="sourceLineNo">244</span><a id="line.244">                case 33:</a>
<span class="sourceLineNo">245</span><a id="line.245">                    return makeShuffledRepeats(rng, "tropical tree 1", 6, "tropical tree 2", 5, "deciduous tree 1", 13, "deciduous tree 2", 12, "small bush 1", 8, "large bush 1", 7, "large bush 2", 7, "large bush 3", 3, "animal burrow", 3);</a>
<span class="sourceLineNo">246</span><a id="line.246">                case 28: //TropicalRainforest</a>
<span class="sourceLineNo">247</span><a id="line.247">                case 34:</a>
<span class="sourceLineNo">248</span><a id="line.248">                case 35:</a>
<span class="sourceLineNo">249</span><a id="line.249">                    return makeShuffledRepeats(rng, "tropical tree 1", 12, "tropical tree 2", 11, "tropical tree 3", 10, "tropical tree 4", 9, "small bush 1", 6, "small bush 2", 5, "large bush 1", 6, "large bush 2", 5, "large bush 3", 3, "animal burrow", 9, "boulder", 1);</a>
<span class="sourceLineNo">250</span><a id="line.250">                case 36: // Rocky</a>
<span class="sourceLineNo">251</span><a id="line.251">                case 37:</a>
<span class="sourceLineNo">252</span><a id="line.252">                    return makeShuffledRepeats(rng, "seashell 1", 3, "seashell 2", 2, "seashell 3", 2, "driftwood", 6, "boulder", 9);</a>
<span class="sourceLineNo">253</span><a id="line.253">                default:</a>
<span class="sourceLineNo">254</span><a id="line.254">                    return new ArrayList&lt;&gt;(0);</a>
<span class="sourceLineNo">255</span><a id="line.255">            }</a>
<span class="sourceLineNo">256</span><a id="line.256">        }</a>
<span class="sourceLineNo">257</span><a id="line.257">//                //COLDEST //COLDER        //COLD            //HOT                  //HOTTER              //HOTTEST</a>
<span class="sourceLineNo">258</span><a id="line.258">//                "Ice",    "Ice",          "Grassland",      "Desert",              "Desert",             "Desert",             //DRYEST</a>
<span class="sourceLineNo">259</span><a id="line.259">//                "Ice",    "Tundra",       "Grassland",      "Grassland",           "Desert",             "Desert",             //DRYER</a>
<span class="sourceLineNo">260</span><a id="line.260">//                "Ice",    "Tundra",       "Woodland",       "Woodland",            "Savanna",            "Desert",             //DRY</a>
<span class="sourceLineNo">261</span><a id="line.261">//                "Ice",    "Tundra",       "SeasonalForest", "SeasonalForest",      "Savanna",            "Savanna",            //WET</a>
<span class="sourceLineNo">262</span><a id="line.262">//                "Ice",    "Tundra",       "BorealForest",   "TemperateRainforest", "TropicalRainforest", "Savanna",            //WETTER</a>
<span class="sourceLineNo">263</span><a id="line.263">//                "Ice",    "BorealForest", "BorealForest",   "TemperateRainforest", "TropicalRainforest", "TropicalRainforest", //WETTEST</a>
<span class="sourceLineNo">264</span><a id="line.264">//                "Rocky",  "Rocky",        "Beach",          "Beach",               "Beach",              "Beach",              //COASTS</a>
<span class="sourceLineNo">265</span><a id="line.265">//                "Ice",    "River",        "River",          "River",               "River",              "River",              //RIVERS</a>
<span class="sourceLineNo">266</span><a id="line.266">//                "Ice",    "River",        "River",          "River",               "River",              "River",              //LAKES</a>
<span class="sourceLineNo">267</span><a id="line.267">//                "Ocean",  "Ocean",        "Ocean",          "Ocean",               "Ocean",              "Ocean",              //OCEAN</a>
<span class="sourceLineNo">268</span><a id="line.268">//                "Empty",                                                                                                       //SPACE</a>
<span class="sourceLineNo">269</span><a id="line.269">    </a>
<span class="sourceLineNo">270</span><a id="line.270">    public WildMap()</a>
<span class="sourceLineNo">271</span><a id="line.271">    {</a>
<span class="sourceLineNo">272</span><a id="line.272">        this(128, 128, 21);</a>
<span class="sourceLineNo">273</span><a id="line.273">    }</a>
<span class="sourceLineNo">274</span><a id="line.274">    public WildMap(int width, int height, int biome)</a>
<span class="sourceLineNo">275</span><a id="line.275">    {</a>
<span class="sourceLineNo">276</span><a id="line.276">        this(width, height, biome, new SilkRNG());</a>
<span class="sourceLineNo">277</span><a id="line.277">    }</a>
<span class="sourceLineNo">278</span><a id="line.278">    public WildMap(int width, int height, int biome, int seedA, int seedB)</a>
<span class="sourceLineNo">279</span><a id="line.279">    {</a>
<span class="sourceLineNo">280</span><a id="line.280">        this(width, height, biome, new SilkRNG(seedA, seedB));</a>
<span class="sourceLineNo">281</span><a id="line.281">    }</a>
<span class="sourceLineNo">282</span><a id="line.282">    public WildMap(int width, int height, int biome, IStatefulRNG rng)</a>
<span class="sourceLineNo">283</span><a id="line.283">    {</a>
<span class="sourceLineNo">284</span><a id="line.284">        this(width, height, biome, rng, floorsByBiome(biome, rng), contentByBiome(biome, rng));</a>
<span class="sourceLineNo">285</span><a id="line.285">    }</a>
<span class="sourceLineNo">286</span><a id="line.286">    public WildMap(int width, int height, int biome, IStatefulRNG rng, ArrayList&lt;String&gt; contentTypes)</a>
<span class="sourceLineNo">287</span><a id="line.287">    {</a>
<span class="sourceLineNo">288</span><a id="line.288">        this(width, height, biome, rng, floorsByBiome(biome, rng), contentTypes);</a>
<span class="sourceLineNo">289</span><a id="line.289">    }</a>
<span class="sourceLineNo">290</span><a id="line.290">    public WildMap(int width, int height, int biome, IStatefulRNG rng, ArrayList&lt;String&gt; floorTypes, ArrayList&lt;String&gt; contentTypes)</a>
<span class="sourceLineNo">291</span><a id="line.291">    {</a>
<span class="sourceLineNo">292</span><a id="line.292">        this.width = width;</a>
<span class="sourceLineNo">293</span><a id="line.293">        this.height = height;</a>
<span class="sourceLineNo">294</span><a id="line.294">        this.biome = biome;</a>
<span class="sourceLineNo">295</span><a id="line.295">        this.rng = rng;</a>
<span class="sourceLineNo">296</span><a id="line.296">        content = ArrayTools.fill(-1, width, height);</a>
<span class="sourceLineNo">297</span><a id="line.297">        floors = new int[width][height];</a>
<span class="sourceLineNo">298</span><a id="line.298">        this.floorTypes = floorTypes;</a>
<span class="sourceLineNo">299</span><a id="line.299">        this.contentTypes = contentTypes;</a>
<span class="sourceLineNo">300</span><a id="line.300">    }</a>
<span class="sourceLineNo">301</span><a id="line.301"></a>
<span class="sourceLineNo">302</span><a id="line.302">    /**</a>
<span class="sourceLineNo">303</span><a id="line.303">     * Produces a map by filling the {@link #floors} 2D array with indices into {@link #floorTypes}, and similarly</a>
<span class="sourceLineNo">304</span><a id="line.304">     * filling the {@link #content} 2D array with indices into {@link #contentTypes}. You only need to call this method</a>
<span class="sourceLineNo">305</span><a id="line.305">     * when you first generate a map with the specific parameters you want, such as biome, and later if you want another</a>
<span class="sourceLineNo">306</span><a id="line.306">     * map with the same parameters.</a>
<span class="sourceLineNo">307</span><a id="line.307">     * &lt;br&gt;</a>
<span class="sourceLineNo">308</span><a id="line.308">     * Virtually all of this method is a wrapper around functionality provided by {@link BlueNoise}, adjusted to fit</a>
<span class="sourceLineNo">309</span><a id="line.309">     * wilderness maps slightly.</a>
<span class="sourceLineNo">310</span><a id="line.310">     */</a>
<span class="sourceLineNo">311</span><a id="line.311">    public void generate() {</a>
<span class="sourceLineNo">312</span><a id="line.312">        ArrayTools.fill(content, -1);</a>
<span class="sourceLineNo">313</span><a id="line.313">        final int seed = rng.nextInt();//, otherSeed = rng.nextInt(), choice = seed + otherSeed &amp; 15;</a>
<span class="sourceLineNo">314</span><a id="line.314">        final int limit = contentTypes.size(), floorLimit = floorTypes.size();</a>
<span class="sourceLineNo">315</span><a id="line.315">        int b;</a>
<span class="sourceLineNo">316</span><a id="line.316">        BlueNoise.blueSpill(floors, floorLimit, rng);</a>
<span class="sourceLineNo">317</span><a id="line.317">        for (int x = 0; x &lt; width; x++) {</a>
<span class="sourceLineNo">318</span><a id="line.318">            for (int y = 0; y &lt; height; y++) {</a>
<span class="sourceLineNo">319</span><a id="line.319">                if((b = BlueNoise.getSeededSeamless(x, y, seed) + 128) &lt; limit)</a>
<span class="sourceLineNo">320</span><a id="line.320">                    content[x][y] = b;</a>
<span class="sourceLineNo">321</span><a id="line.321">                //floors[x][y] = (int)((FastNoise.instance.layered2D(x,  y, otherSeed, 2, 0x1p-5f) * 0.4999f + 0.5f) * (floorLimit - 1) + 0.25f + rng.nextFloat(0.5f));</a>
<span class="sourceLineNo">322</span><a id="line.322">            }</a>
<span class="sourceLineNo">323</span><a id="line.323">        }</a>
<span class="sourceLineNo">324</span><a id="line.324">    }</a>
<span class="sourceLineNo">325</span><a id="line.325">    </a>
<span class="sourceLineNo">326</span><a id="line.326">    public static class MixedWildMap extends WildMap implements Serializable</a>
<span class="sourceLineNo">327</span><a id="line.327">    {</a>
<span class="sourceLineNo">328</span><a id="line.328">        private static final long serialVersionUID = 1L;</a>
<span class="sourceLineNo">329</span><a id="line.329">        public final int[][] pieceMap;</a>
<span class="sourceLineNo">330</span><a id="line.330">        public final WildMap[] pieces;</a>
<span class="sourceLineNo">331</span><a id="line.331">        protected final int[] minFloors, maxFloors, minContents, maxContents;</a>
<span class="sourceLineNo">332</span><a id="line.332">        </a>
<span class="sourceLineNo">333</span><a id="line.333">        public MixedWildMap()</a>
<span class="sourceLineNo">334</span><a id="line.334">        {</a>
<span class="sourceLineNo">335</span><a id="line.335">            this(new WildMap(), new WildMap(), new WildMap(), new WildMap(), new SilkRNG());</a>
<span class="sourceLineNo">336</span><a id="line.336">        }</a>
<span class="sourceLineNo">337</span><a id="line.337">        </a>
<span class="sourceLineNo">338</span><a id="line.338">        public MixedWildMap(WildMap northeast, WildMap southeast, WildMap southwest, WildMap northwest, IStatefulRNG rng)</a>
<span class="sourceLineNo">339</span><a id="line.339">        {</a>
<span class="sourceLineNo">340</span><a id="line.340">            super(northeast.width, northeast.height, northeast.biome, rng, new ArrayList&lt;&gt;(northeast.floorTypes), new ArrayList&lt;&gt;(northeast.contentTypes));</a>
<span class="sourceLineNo">341</span><a id="line.341">            minFloors = new int[4];</a>
<span class="sourceLineNo">342</span><a id="line.342">            maxFloors = new int[4];</a>
<span class="sourceLineNo">343</span><a id="line.343">            minContents = new int[4];</a>
<span class="sourceLineNo">344</span><a id="line.344">            maxContents = new int[4];</a>
<span class="sourceLineNo">345</span><a id="line.345">            floorTypes.addAll(southeast.floorTypes);</a>
<span class="sourceLineNo">346</span><a id="line.346">            floorTypes.addAll(southwest.floorTypes);</a>
<span class="sourceLineNo">347</span><a id="line.347">            floorTypes.addAll(northwest.floorTypes);</a>
<span class="sourceLineNo">348</span><a id="line.348">            contentTypes.addAll(southeast.contentTypes);</a>
<span class="sourceLineNo">349</span><a id="line.349">            contentTypes.addAll(southwest.contentTypes);</a>
<span class="sourceLineNo">350</span><a id="line.350">            contentTypes.addAll(northwest.contentTypes);</a>
<span class="sourceLineNo">351</span><a id="line.351">            minFloors[1]   = maxFloors[0]   = northeast.floorTypes.size();</a>
<span class="sourceLineNo">352</span><a id="line.352">            minContents[1] = maxContents[0] = northeast.contentTypes.size();</a>
<span class="sourceLineNo">353</span><a id="line.353">            minFloors[2]   = maxFloors[1]   = maxFloors[0]    + southeast.floorTypes.size();</a>
<span class="sourceLineNo">354</span><a id="line.354">            minContents[2] = maxContents[1] = maxContents[0]  + southeast.contentTypes.size();</a>
<span class="sourceLineNo">355</span><a id="line.355">            minFloors[3]   = maxFloors[2]   = maxFloors[1]    + southwest.floorTypes.size();</a>
<span class="sourceLineNo">356</span><a id="line.356">            minContents[3] = maxContents[2] = maxContents[1]  + southwest.contentTypes.size();</a>
<span class="sourceLineNo">357</span><a id="line.357">            maxFloors[3]   = maxFloors[2]    + northwest.floorTypes.size();</a>
<span class="sourceLineNo">358</span><a id="line.358">            maxContents[3] = maxContents[2]  + northwest.contentTypes.size();</a>
<span class="sourceLineNo">359</span><a id="line.359">            pieces = new WildMap[]{northeast, southeast, southwest, northwest};</a>
<span class="sourceLineNo">360</span><a id="line.360">            pieceMap = new int[width][height];</a>
<span class="sourceLineNo">361</span><a id="line.361">        }</a>
<span class="sourceLineNo">362</span><a id="line.362">        </a>
<span class="sourceLineNo">363</span><a id="line.363">        protected void preparePieceMap()</a>
<span class="sourceLineNo">364</span><a id="line.364">        {</a>
<span class="sourceLineNo">365</span><a id="line.365">            ArrayTools.fill(pieceMap, 255);</a>
<span class="sourceLineNo">366</span><a id="line.366">            pieceMap[width - 1][0] = 0; // northeast</a>
<span class="sourceLineNo">367</span><a id="line.367">            pieceMap[width - 1][height - 1] = 1; // southeast</a>
<span class="sourceLineNo">368</span><a id="line.368">            pieceMap[0][height - 1] = 2; // southwest</a>
<span class="sourceLineNo">369</span><a id="line.369">            pieceMap[0][0] = 3; //northwest</a>
<span class="sourceLineNo">370</span><a id="line.370">            final int spillerLimit = 4;</a>
<span class="sourceLineNo">371</span><a id="line.371">            final Direction[] dirs = Direction.CARDINALS;</a>
<span class="sourceLineNo">372</span><a id="line.372">            Direction d;</a>
<span class="sourceLineNo">373</span><a id="line.373">            int t, rx, ry, ctr;</a>
<span class="sourceLineNo">374</span><a id="line.374">            int[] ox = new int[width], oy = new int[height];</a>
<span class="sourceLineNo">375</span><a id="line.375">            boolean anySuccesses = false;</a>
<span class="sourceLineNo">376</span><a id="line.376">            do {</a>
<span class="sourceLineNo">377</span><a id="line.377">                ctr = 0;</a>
<span class="sourceLineNo">378</span><a id="line.378">                rng.randomOrdering(width, ox);</a>
<span class="sourceLineNo">379</span><a id="line.379">                rng.randomOrdering(height, oy);</a>
<span class="sourceLineNo">380</span><a id="line.380">                for (int x = 0; x &lt; width; x++) {</a>
<span class="sourceLineNo">381</span><a id="line.381">                    rx = ox[x];</a>
<span class="sourceLineNo">382</span><a id="line.382">                    for (int y = 0; y &lt; height; y++) {</a>
<span class="sourceLineNo">383</span><a id="line.383">                        ry = oy[y];</a>
<span class="sourceLineNo">384</span><a id="line.384">                        if ((t = pieceMap[rx][ry]) &lt; spillerLimit) {</a>
<span class="sourceLineNo">385</span><a id="line.385">                            d = dirs[rng.next(2)];</a>
<span class="sourceLineNo">386</span><a id="line.386">                            if (rx + d.deltaX &gt;= 0 &amp;&amp; rx + d.deltaX &lt; width &amp;&amp; ry + d.deltaY &gt;= 0 &amp;&amp; ry + d.deltaY &lt; height &amp;&amp;</a>
<span class="sourceLineNo">387</span><a id="line.387">                                    pieceMap[rx + d.deltaX][ry + d.deltaY] &gt;= spillerLimit) {</a>
<span class="sourceLineNo">388</span><a id="line.388">                                pieceMap[rx + d.deltaX][ry + d.deltaY] = t;</a>
<span class="sourceLineNo">389</span><a id="line.389">                                ctr++;</a>
<span class="sourceLineNo">390</span><a id="line.390">                            }</a>
<span class="sourceLineNo">391</span><a id="line.391">                            d = dirs[rng.next(2)];</a>
<span class="sourceLineNo">392</span><a id="line.392">                            if (rx + d.deltaX &gt;= 0 &amp;&amp; rx + d.deltaX &lt; width &amp;&amp; ry + d.deltaY &gt;= 0 &amp;&amp; ry + d.deltaY &lt; height &amp;&amp;</a>
<span class="sourceLineNo">393</span><a id="line.393">                                    pieceMap[rx + d.deltaX][ry + d.deltaY] &gt;= spillerLimit) {</a>
<span class="sourceLineNo">394</span><a id="line.394">                                pieceMap[rx + d.deltaX][ry + d.deltaY] = t;</a>
<span class="sourceLineNo">395</span><a id="line.395">                                ctr++;</a>
<span class="sourceLineNo">396</span><a id="line.396">                            }</a>
<span class="sourceLineNo">397</span><a id="line.397">                        }</a>
<span class="sourceLineNo">398</span><a id="line.398"></a>
<span class="sourceLineNo">399</span><a id="line.399">                    }</a>
<span class="sourceLineNo">400</span><a id="line.400">                }</a>
<span class="sourceLineNo">401</span><a id="line.401">                if(!anySuccesses &amp;&amp; ctr == 0)</a>
<span class="sourceLineNo">402</span><a id="line.402">                {</a>
<span class="sourceLineNo">403</span><a id="line.403">                    ArrayTools.fill(pieceMap, 0);</a>
<span class="sourceLineNo">404</span><a id="line.404">                    return;</a>
<span class="sourceLineNo">405</span><a id="line.405">                }</a>
<span class="sourceLineNo">406</span><a id="line.406">                else</a>
<span class="sourceLineNo">407</span><a id="line.407">                    anySuccesses = true;</a>
<span class="sourceLineNo">408</span><a id="line.408">            } while (ctr &gt; 0);</a>
<span class="sourceLineNo">409</span><a id="line.409">            do {</a>
<span class="sourceLineNo">410</span><a id="line.410">                ctr = 0;</a>
<span class="sourceLineNo">411</span><a id="line.411">                rng.randomOrdering(width, ox);</a>
<span class="sourceLineNo">412</span><a id="line.412">                rng.randomOrdering(height, oy);</a>
<span class="sourceLineNo">413</span><a id="line.413">                for (int x = 0; x &lt; width; x++) {</a>
<span class="sourceLineNo">414</span><a id="line.414">                    rx = ox[x];</a>
<span class="sourceLineNo">415</span><a id="line.415">                    for (int y = 0; y &lt; height; y++) {</a>
<span class="sourceLineNo">416</span><a id="line.416">                        ry = oy[y];</a>
<span class="sourceLineNo">417</span><a id="line.417">                        if ((t = pieceMap[rx][ry]) &lt; spillerLimit) {</a>
<span class="sourceLineNo">418</span><a id="line.418">                            for (int i = 0; i &lt; 4; i++) {</a>
<span class="sourceLineNo">419</span><a id="line.419">                                d = dirs[i];</a>
<span class="sourceLineNo">420</span><a id="line.420">                                if (rx + d.deltaX &gt;= 0 &amp;&amp; rx + d.deltaX &lt; width &amp;&amp; ry + d.deltaY &gt;= 0 &amp;&amp; ry + d.deltaY &lt; height &amp;&amp;</a>
<span class="sourceLineNo">421</span><a id="line.421">                                        pieceMap[rx + d.deltaX][ry + d.deltaY] &gt;= spillerLimit) {</a>
<span class="sourceLineNo">422</span><a id="line.422">                                    pieceMap[rx + d.deltaX][ry + d.deltaY] = t;</a>
<span class="sourceLineNo">423</span><a id="line.423">                                    ctr++;</a>
<span class="sourceLineNo">424</span><a id="line.424">                                }</a>
<span class="sourceLineNo">425</span><a id="line.425">                            }</a>
<span class="sourceLineNo">426</span><a id="line.426">                        }</a>
<span class="sourceLineNo">427</span><a id="line.427"></a>
<span class="sourceLineNo">428</span><a id="line.428">                    }</a>
<span class="sourceLineNo">429</span><a id="line.429">                }</a>
<span class="sourceLineNo">430</span><a id="line.430">            } while (ctr &gt; 0);</a>
<span class="sourceLineNo">431</span><a id="line.431"></a>
<span class="sourceLineNo">432</span><a id="line.432">        }</a>
<span class="sourceLineNo">433</span><a id="line.433"></a>
<span class="sourceLineNo">434</span><a id="line.434">        @Override</a>
<span class="sourceLineNo">435</span><a id="line.435">        public void generate() {</a>
<span class="sourceLineNo">436</span><a id="line.436">            ArrayTools.fill(content, -1);</a>
<span class="sourceLineNo">437</span><a id="line.437">            for (int i = 0; i &lt; pieces.length; i++) {</a>
<span class="sourceLineNo">438</span><a id="line.438">                pieces[i].generate();</a>
<span class="sourceLineNo">439</span><a id="line.439">            }</a>
<span class="sourceLineNo">440</span><a id="line.440">            preparePieceMap();</a>
<span class="sourceLineNo">441</span><a id="line.441">            int p, c;</a>
<span class="sourceLineNo">442</span><a id="line.442">            WildMap piece;</a>
<span class="sourceLineNo">443</span><a id="line.443">            for (int x = 0; x &lt; width; x++) {</a>
<span class="sourceLineNo">444</span><a id="line.444">                for (int y = 0; y &lt; height; y++) {</a>
<span class="sourceLineNo">445</span><a id="line.445">                    p = pieceMap[x][y];</a>
<span class="sourceLineNo">446</span><a id="line.446">                    piece = pieces[p];</a>
<span class="sourceLineNo">447</span><a id="line.447">                    floors[x][y] = piece.floors[x][y] + minFloors[p];</a>
<span class="sourceLineNo">448</span><a id="line.448">                    if((c = piece.content[x][y]) &gt;= 0)</a>
<span class="sourceLineNo">449</span><a id="line.449">                    {</a>
<span class="sourceLineNo">450</span><a id="line.450">                        content[x][y] = c + minContents[p];</a>
<span class="sourceLineNo">451</span><a id="line.451">                    }</a>
<span class="sourceLineNo">452</span><a id="line.452">                }</a>
<span class="sourceLineNo">453</span><a id="line.453">            }</a>
<span class="sourceLineNo">454</span><a id="line.454">        }</a>
<span class="sourceLineNo">455</span><a id="line.455">    }</a>
<span class="sourceLineNo">456</span><a id="line.456">}</a>




























































</pre>
</div>
</main>
</body>
</html>
